<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Expressio ‚Äî Data Room</title>
  <meta name="description" content="Data Room ‚Äî Expressio: Log√≠stica + Fintech para PMEs de E-commerce"/>
  <meta name="robots" content="noindex, nofollow"/>
  <link rel="icon" href="https://expressio.com.br/favicon.ico">
  <meta property="og:title" content="Expressio ‚Äî Data Room"/>
  <meta property="og:description" content="Log√≠stica + Fintech para PMEs de E-commerce"/>
  <meta property="og:type" content="website"/>
  <meta name="theme-color" content="#0b1016">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/echarts-gl@2/dist/echarts-gl.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/map/js/world.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-matrix@2.0.1/dist/chartjs-chart-matrix.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>

  <!-- (Opcional) Plausible: troque o dom√≠nio abaixo e descomente -->
  <!-- <script defer data-domain="expressio-headline.vercel.app" src="https://plausible.io/js/script.js"></script> -->

  <style>
    :root{
      /* Paleta default (substitu√≠da por JS se LOGO_URL for carregado) */
      --bg:#0b1016; --bg-soft:#0e141b; --card:#111823; --text:#e6edf3; --muted:#9fb1c7;
      --brand:#14b8a6; --brand-2:#2563eb; --accent:#f6c945; --ring:0 0 0 1px rgba(20,184,166,.18), 0 12px 34px rgba(37,99,235,.12);
      --ok:#4ade80; --warn:#f59e0b; --bad:#ef4444;
    }
    [data-theme="light"]{
      --bg:#f8fafc; --bg-soft:#f1f5f9; --card:#fff; --text:#0b1016; --muted:#475569;
      --brand:#0ea5a3; --brand-2:#1d4ed8; --accent:#b45309; --ring:0 2px 14px rgba(37,99,235,.15);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; color:var(--text);
      background: radial-gradient(900px 520px at 15% -10%, color-mix(in srgb, var(--brand) 12%, transparent), transparent 60%),
                  radial-gradient(900px 520px at 115% 0%, color-mix(in srgb, var(--brand-2) 12%, transparent), transparent 60%), var(--bg)}
    a{color:var(--brand-2); text-decoration:none}
    .container{max-width:1200px; margin:0 auto; padding:0 20px}
    header{position:sticky; top:0; z-index:50; backdrop-filter:saturate(1.1) blur(10px);
      background:color-mix(in srgb, var(--bg) 92%, transparent);
      border-bottom:1px solid color-mix(in srgb, var(--text) 12%, transparent)}
    .nav{display:flex; align-items:center; justify-content:space-between; padding:14px 0}
    .brand{display:flex; align-items:center; gap:12px; font-weight:800}
    .brand img{height:26px}
    .nav a{margin:0 10px; color:var(--muted); font-weight:500} .nav a:hover{color:var(--text)}
    .mode{padding:8px 12px; background:var(--card); border:1px solid color-mix(in srgb, var(--text) 11%, transparent);
      border-radius:10px; color:var(--muted); cursor:pointer}
    .hero{padding:54px 0 18px}
    .hero h1{font-size:38px; margin:8px 0}
    .tag{display:inline-flex; align-items:center; gap:8px; background:var(--card);
      border:1px solid color-mix(in srgb, var(--text) 10%, transparent); color:var(--muted);
      padding:8px 12px; border-radius:999px; box-shadow:var(--ring)}
    .muted{color:var(--muted)}

    .kpis{display:grid; grid-template-columns:repeat(4,1fr); gap:16px; margin:18px 0 8px}
    .card{background:var(--card); border:1px solid color-mix(in srgb, var(--text) 10%, transparent);
      border-radius:16px; padding:16px; box-shadow:var(--ring)}
    .kpi-title{color:var(--muted); font-size:12px; text-transform:uppercase; letter-spacing:.12em}
    .kpi-value{font-size:28px; font-weight:800; margin-top:6px}
    .kpi-sub{color:var(--muted); font-size:12px}

    section{padding:22px 0}
    .grid-2{display:grid; grid-template-columns:1.12fr .88fr; gap:16px}
    .grid{display:grid; gap:16px}
    .chart{height:360px; border-radius:14px; background:var(--bg-soft); border:1px dashed color-mix(in srgb, var(--text) 10%, transparent)}
    .chart.tall{height:460px}
    .h{margin:0 0 10px; font-size:18px; letter-spacing:.02em}

    .controls{display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-top:12px}
    .control{background:var(--bg-soft); border:1px solid color-mix(in srgb, var(--text) 10%, transparent); padding:12px; border-radius:12px}
    .control label{display:flex; justify-content:space-between; font-size:12px; color:var(--muted)}
    .control input[type="range"]{width:100%}
    .pill{display:inline-flex; gap:6px; padding:6px 10px; border-radius:999px; background:color-mix(in srgb, var(--brand) 22%, transparent); color:var(--brand)}

    .docs a{display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-radius:12px;
      background:var(--bg-soft); border:1px solid color-mix(in srgb, var(--text) 10%, transparent); color:var(--text)}
    .docs a span{color:var(--muted); font-size:12px}
    footer{padding:30px 0 50px; color:var(--muted); text-align:center}

    .spark{height:110px}
    @media (max-width:980px){ .kpis{grid-template-columns:repeat(2,1fr)} .grid-2{grid-template-columns:1fr} }

    /* Watermark confidencial (sem bloqueio de acesso) */
    .wm:before{
      content:"CONFIDENCIAL ‚Äì EXPRESSIO"; position:fixed; inset:0; pointer-events:none; z-index:0;
      background:
        repeating-linear-gradient(45deg, rgba(255,255,255,.03) 0 40px, transparent 40px 80px),
        repeating-linear-gradient(-45deg, rgba(255,255,255,.03) 0 40px, transparent 40px 80px);
      mix-blend-mode:overlay
    }
  </style>
</head>
<body data-theme="dark">
<header>
  <div class="container nav">
    <div class="brand">
      <img id="logo" alt="Expressio" src="" onerror="this.style.display='none'"/>
      <div>Expressio <span class="muted" style="font-weight:600">Data Room</span></div>
    </div>
    <nav>
      <a href="#kpis">KPIs</a><a href="#network">Rede</a><a href="#ops">Opera√ß√£o</a><a href="#unit">Unit Economics</a>
      <a href="#cohorts">Cohorts</a><a href="#docs">Documentos</a>
    </nav>
    <div style="display:flex; gap:8px"><button class="mode" id="modeBtn">üåô / ‚òÄÔ∏è</button></div>
  </div>
</header>

<div class="container wm" id="content">
  <section class="hero">
    <span class="tag">Log√≠stica + Fintech para PMEs de E-commerce</span>
    <h1>Opera√ß√£o inteligente, custo previs√≠vel e capital para escalar</h1>
    <p class="muted">SLO que unifica envios, integra transportadoras e adiciona fintech nativa para PMEs. </p>
  </section>

  <!-- KPIs Top + Sparklines -->
  <section id="kpis">
    <div class="kpis">
      <div class="card">
        <div class="kpi-title">Receita (√∫ltimos 6m)</div>
        <div class="kpi-value" id="kpiRevenue">R$ 0</div>
        <div class="kpi-sub" id="kpiRevSub">MoM</div>
        <canvas id="sparkRev" class="spark"></canvas>
      </div>
      <div class="card">
        <div class="kpi-title">Clientes Ativos</div>
        <div class="kpi-value" id="kpiClients">0</div>
        <div class="kpi-sub">Sob NDA</div>
        <canvas id="sparkClients" class="spark"></canvas>
      </div>
      <div class="card">
        <div class="kpi-title">Envios / m√™s</div>
        <div class="kpi-value" id="kpiShip">0</div>
        <div class="kpi-sub" id="kpiShipSub">Crescimento</div>
        <canvas id="sparkShip" class="spark"></canvas>
      </div>
      <div class="card">
        <div class="kpi-title">LTV / CAC</div>
        <div class="kpi-value" id="kpiRatio">0.0x</div>
        <div class="kpi-sub">Meta ‚â• 3.0x</div>
        <div id="gauge" class="chart" style="height:150px; margin-top:8px; display:flex; align-items:center; justify-content:center"></div>
      </div>
    </div>
  </section>

  <!-- Rede / Globo -->
  <section id="network" class="grid-2">
    <div class="card">
      <h3 class="h">Rede LatAm (rotas animadas)</h3>
      <div id="globe" class="chart tall"></div>
    </div>
    <div class="grid">
      <div class="card">
        <h3 class="h">Simulador What‚Äëif</h3>
        <div class="controls">
          <div class="control"><label><span>Envios/m√™s</span><b><span id="s_ship_v">0</span></b></label><input id="s_ship" type="range" min="1000" max="200000" step="1000" value="15000"/></div>
          <div class="control"><label><span>Take rate (%)</span><b><span id="s_rate_v">0</span>%</b></label><input id="s_rate" type="range" min="2" max="15" step="0.1" value="6.0"/></div>
          <div class="control"><label><span>ARPU (R$)</span><b><span id="s_arpu_v">0</span></b></label><input id="s_arpu" type="range" min="200" max="8000" step="50" value="2500"/></div>
        </div>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top:12px">
          <span class="pill">Receita estimada: <b id="sim_rev">R$ 0</b></span>
          <span class="pill">Margem fintech: <b id="sim_fin">R$ 0</b></span>
          <span class="pill">LTV/CAC: <b id="sim_ratio">0.0x</b></span>
        </div>
      </div>
      <div class="card">
        <h3 class="h">Notas</h3>
        <ul class="muted" style="margin-top:2px; line-height:1.6">
          <li>Dados base reais: <b>R$ 200 mil em 6 meses</b>, <b>10 clientes ativos</b>.</li>
          <li>Atualize o objeto <code>DATA</code> para refletir √∫ltimas m√©tricas.</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Opera√ß√£o -->
  <section id="ops" class="grid-2">
    <div class="card">
      <h3 class="h">Sankey ‚Äî do Pedido √† Entrega</h3>
      <div id="sankey" class="chart"></div>
    </div>
    <div class="card" id="unit">
      <h3 class="h">Waterfall ‚Äî Unit Economics por envio</h3>
      <div id="waterfall" class="chart"></div>
    </div>
  </section>

  <!-- S√©ries MoM -->
  <section class="grid-2">
    <div class="card"><h3 class="h">Receita MoM (√°rea)</h3><canvas id="areaRevenue" class="chart"></canvas></div>
    <div class="card"><h3 class="h">Envios MoM (coluna)</h3><canvas id="barShipments" class="chart"></canvas></div>
  </section>

  <!-- Cohorts -->
  <section id="cohorts" class="grid-2">
    <div class="card"><h3 class="h">Cohorts de Receita (MRR)</h3><canvas id="cohortChart" class="chart"></canvas></div>
    <div class="card"><h3 class="h">Time & Contatos</h3>
      <div style="display:grid; gap:8px" class="muted">
        <div><b style="color:var(--text)">Fundadores:</b> Nome 1 ‚Ä¢ Nome 2 ‚Äî advisors sob NDA</div>
        <div><b style="color:var(--text)">Contato:</b> invest@expressio.com.br</div>
        <div><b style="color:var(--text)">Calendly:</b> <a href="#">Agendar 30 min</a></div>
      </div>
    </div>
  </section>

  <!-- Documentos -->
  <section id="docs" class="grid">
    <div class="card"><h3 class="h">Documentos</h3>
      <div class="docs grid">
        <a href="#" target="_blank" rel="noopener">Pitch Deck <span>PDF</span></a>
        <a href="#" target="_blank" rel="noopener">Proje√ß√µes Financeiras <span>XLSX/Sheets</span></a>
        <a href="#" target="_blank" rel="noopener">Contratos/Parcerias <span>ZIP</span></a>
        <a href="#" target="_blank" rel="noopener">Term Sheet/SAFE (se aplic√°vel) <span>PDF</span></a>
      </div>
    </div>
  </section>

  <footer>¬© Expressio ‚Äî confidencial. Acesso sob convite.</footer>
</div>

<script>
/* =============================
   CONFIGURA√á√ÉO R√ÅPIDA
============================= */
const CONFIG = {
  LOGO_URLS: [
    'https://expressio.com.br/wp-content/uploads/logo-expressio.svg',
    'https://expressio.com.br/wp-content/uploads/logo.png',
    'https://expressio.com.br/favicon.ico'
  ],
  BRAND_COLORS: {
    // Ajuste manual (se quiser for√ßar):
    primary: '#14b8a6', secondary: '#2563eb', bg: '#0b1016', text:'#e6edf3'
  }
};

/* =============================
   DADOS (reais base)
============================= */
const DATA = {
  revenueMonthly: [18000, 26000, 34000, 41000, 42000, 39000], // soma ‚âà 200k
  shipmentsMonthly: [4200, 6800, 9000, 12000, 14500, 16000],
  clientsActive: 10,
  ltv: 12000, cac: 2800,
  flows: { carriers:["Carrier A","Carrier B","Carrier C"], mix:[0.5,0.3,0.2], outOnTime:0.89, outDelay:0.08, outException:0.03 },
  cohorts: {
    labels:["M1","M2","M3","M4","M5","M6","M7","M8","M9","M10","M11","M12"],
    rows:[
      { cohort:"2025‚Äë01", values:[22,21,20,19,19,18,17,16,16,15,14,13] },
      { cohort:"2025‚Äë02", values:[18,17,17,16,16,15,15,14,13,13,12,11] },
      { cohort:"2025‚Äë03", values:[26,25,24,23,22,22,21,20,20,19,18,17] },
      { cohort:"2025‚Äë04", values:[30,29,28,27,26,25,24,24,23,22,21,20] }
    ]
  },
  unitEconomics:{ pricePerShipment:18, carrierCost:12.2, fintechMarginPerShipment:0.85, otherOps:1.1 },
  hubs:{
    saoPaulo:[-23.55,-46.63], buenosAires:[-34.60,-58.38], santiago:[-33.45,-70.66],
    lima:[-12.05,-77.04], bogota:[4.71,-74.07], mexicoCity:[19.43,-99.13]
  },
  routes:[
    {from:'saoPaulo',to:'santiago',volume:120}, {from:'saoPaulo',to:'buenosAires',volume:180},
    {from:'saoPaulo',to:'lima',volume:90}, {from:'saoPaulo',to:'bogota',volume:70},
    {from:'mexicoCity',to:'bogota',volume:110}, {from:'mexicoCity',to:'lima',volume:60}
  ],
  simDefault:{ shipments:15000, takeRatePct:6.0, arpu:2500 }
};

/* ======== Tema autom√°tico a partir do logo (com fallback) ======== */
(function loadLogoAndTheme(){
  const imgEl = document.getElementById('logo');
  (async()=>{
    for(const url of CONFIG.LOGO_URLS){
      try{ await tryLoad(url); imgEl.src=url; break; }catch(e){}
    }
    // Aplica cores manuais (edite aqui se desejar)
    setTheme(CONFIG.BRAND_COLORS);
  })();

  function tryLoad(url){
    return new Promise((res,rej)=>{ const i=new Image(); i.crossOrigin='anonymous'; i.onload=()=>res(url); i.onerror=rej; i.src=url; });
  }

  function setTheme(p){
    const r = document.documentElement;
    if(p.bg) r.style.setProperty('--bg', p.bg);
    if(p.primary) r.style.setProperty('--brand', p.primary);
    if(p.secondary) r.style.setProperty('--brand-2', p.secondary);
    if(p.text) r.style.setProperty('--text', p.text);
    // Derivados
    r.style.setProperty('--bg-soft', getComputedStyle(r).getPropertyValue('--bg'));
  }
})();

/* ========= Dark/Light ========= */
  document.getElementById('modeBtn').onclick = ()=>{
    const b=document.body; b.dataset.theme = b.dataset.theme==='dark'?'light':'dark'; };

/* ========= KPIs & Sparklines ========= */
(function initKPIs(){
  const rev6 = DATA.revenueMonthly.reduce((a,b)=>a+b,0);
  const mom = (DATA.revenueMonthly.at(-1)/DATA.revenueMonthly.at(-2)-1)*100;
  const shipMoM = (DATA.shipmentsMonthly.at(-1)/DATA.shipmentsMonthly.at(-2)-1)*100;

  animCounter("kpiRevenue", rev6, v=>fmtBRL(v));
  document.getElementById("kpiRevSub").textContent = `MoM: ${mom>=0?'+':''}${mom.toFixed(1)}%`;
  animCounter("kpiClients", DATA.clientsActive, v=>v.toFixed(0));
  animCounter("kpiShip", DATA.shipmentsMonthly.at(-1), v=>fmtK(v));
  document.getElementById("kpiShipSub").textContent = `MoM: ${shipMoM>=0?'+':''}${shipMoM.toFixed(1)}%`;
  const ratio = DATA.ltv/DATA.cac; animCounter("kpiRatio", ratio, v=>v.toFixed(1)+'x');

  function animCounter(id, target, fmt){
    anime({targets:{val:0}, val:target, round:1, easing:'easeOutQuad', duration:1200,
      update:anim=>{ document.getElementById(id).textContent = fmt(anim.animations[0].currentValue) }});
  }

  new Chart(document.getElementById('sparkRev'), {type:'line', data:{labels:DATA.revenueMonthly.map((_,i)=>`M${i+1}`), datasets:[{data:DATA.revenueMonthly, fill:true, tension:.35, borderColor:'var(--brand-2)', backgroundColor:'rgba(37,99,235,.18)', pointRadius:0}]}, options:{responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{x:{display:false}, y:{display:false}}});
  new Chart(document.getElementById('sparkClients'), {type:'line', data:{labels:DATA.revenueMonthly.map((_,i)=>`M${i+1}`), datasets:[{data:[6,7,8,9,10,10], tension:.35, borderColor:'var(--brand)', backgroundColor:'rgba(20,184,166,.18)', pointRadius:0, fill:true}]}, options:{responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{x:{display:false}, y:{display:false}}});
  new Chart(document.getElementById('sparkShip'), {type:'bar', data:{labels:DATA.shipmentsMonthly.map((_,i)=>`M${i+1}`), datasets:[{data:DATA.shipmentsMonthly, backgroundColor:'rgba(246,201,69,.40)', borderColor:'var(--accent)', borderWidth:1}]}, options:{responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{x:{display:false}, y:{display:false}}});
})();

/* ======== Globo/Mapa ======== */
(function initGlobe(){
  const el = document.getElementById('globe');
  const chart = echarts.init(el);
  try{
    const routes3D = DATA.routes.map(r=>({ coords:[[DATA.hubs[r.from][1],DATA.hubs[r.from][0]],[DATA.hubs[r.to][1],DATA.hubs[r.to][0]]], value:r.volume }));
    const points = Object.values(DATA.hubs).map(([lat,lng])=>({name:'', value:[lng,lat,10]}));
    chart.setOption({
      backgroundColor:'transparent',
      globe:{ baseTexture:'https://cdn.jsdelivr.net/npm/echarts-gl@2/examples/data-gl/asset/world.topo.bathy.200401.jpg', heightTexture:'https://cdn.jsdelivr.net/npm/echarts-gl@2/examples/data-gl/asset/bathymetry_bw_composite_4k.jpg', shading:'realistic', realisticMaterial:{roughness:.9}, light:{ambient:{intensity:.6}, main:{intensity:.5}}, viewControl:{autoRotate:true, autoRotateAfterStill:5, targetCoord:[-50,-15], distance:150}},
      series:[
        {type:'lines3D', coordinateSystem:'globe', effect:{show:true, trailWidth:2, trailLength:.2, trailColor:getCSS('--brand'), trailOpacity:.9}, blendMode:'lighter', lineStyle:{width:1, color:getCSS('--brand-2'), opacity:.3}, data:routes3D},
        {type:'scatter3D', coordinateSystem:'globe', symbolSize:6, itemStyle:{color:'var(--accent)'}, data:points}
      ]
    });
  } catch(e){
    const convert = ([lat,lng])=>[lng,lat];
    const lines = DATA.routes.map(r=>({coords:[convert(DATA.hubs[r.from]), convert(DATA.hubs[r.to])], value:r.volume}));
    const scatter = Object.values(DATA.hubs).map(([lat,lng])=>({value:[lng,lat,10]}));
    chart.setOption({backgroundColor:'transparent', geo:{map:'world', roam:true, zoom:1.2, center:[-60,-15], itemStyle:{areaColor:'var(--bg-soft)', borderColor:'#1f2a37'}, emphasis:{itemStyle:{areaColor:'#1f2937'}}}, series:[ {type:'lines', coordinateSystem:'geo', effect:{show:true, symbol:'arrow', symbolSize:6, color:getCSS('--brand')}, lineStyle:{color:getCSS('--brand-2'), width:1, opacity:.6, curveness:.2}, data:lines}, {type:'effectScatter', coordinateSystem:'geo', symbolSize:8, itemStyle:{color:'var(--accent')}, data:scatter} ]});
  }
  new ResizeObserver(()=>chart.resize()).observe(el);
})();

/* ======= Gauge LTV/CAC (SVG) ======= */
(function initGauge(){
  const container = document.getElementById('gauge');
  const w=360,h=150,r=120,cx=w/2,cy=h*1.1; const ratio = clamp(DATA.ltv/DATA.cac,0,6);
  const NS='http://www.w3.org/2000/svg', svg=document.createElementNS(NS,'svg'); svg.setAttribute('viewBox',`0 0 ${w} ${h}`); svg.style.width='100%';
  const arc=(start,end,color,width)=>{const p=document.createElementNS(NS,'path'); p.setAttribute('stroke',color); p.setAttribute('stroke-width',width); p.setAttribute('fill','none'); p.setAttribute('d',desc(cx,cy,r,start,end)); return p;}
  const t=document.createElementNS(NS,'path'); t.setAttribute('d',desc(cx,cy,r,180,360)); t.setAttribute('stroke','rgba(255,255,255,.12)'); t.setAttribute('stroke-width','12'); t.setAttribute('fill','none'); svg.appendChild(t);
  const v=arc(180,180, getCSS('--brand-2'),14); svg.appendChild(v);
  const needle=document.createElementNS(NS,'line'); needle.setAttribute('x1',cx); needle.setAttribute('y1',cy); needle.setAttribute('x2',cx); needle.setAttribute('y2',cy-r+16); needle.setAttribute('stroke',getCSS('--text')); needle.setAttribute('stroke-width','3'); needle.setAttribute('stroke-linecap','round'); svg.appendChild(needle);
  const text=document.createElementNS(NS,'text'); text.setAttribute('x',cx); text.setAttribute('y',cy-26); text.setAttribute('text-anchor','middle'); text.setAttribute('font-size','22'); text.setAttribute('font-weight','800'); text.textContent = (DATA.ltv/DATA.cac).toFixed(1)+'x'; svg.appendChild(text);
  container.appendChild(svg);
  anime({targets:{t:180}, t:180+(ratio/6)*180, easing:'spring(1, 80, 10, 0)', duration:1100, update:a=>{const e=a.animations[0].currentValue; v.setAttribute('d',desc(cx,cy,r,180,e)); const rad=(e-90)*Math.PI/180; needle.setAttribute('x2',cx + (r-8)*Math.cos(rad)); needle.setAttribute('y2',cy + (r-8)*Math.sin(rad)); }});
  function desc(cx,cy,r,start,end){const s=pt(cx,cy,r,end), e=pt(cx,cy,r,start), large=end-start<=180?0:1; return `M ${s.x} ${s.y} A ${r} ${r} 0 ${large} 0 ${e.x} ${e.y}`;}
  function pt(cx,cy,r,a){const rad=(a-90)*Math.PI/180; return {x:cx+r*Math.cos(rad), y:cy+r*Math.sin(rad)};}
})();

/* =============== Sankey =============== */
(function initSankey(){
  const el = document.getElementById('sankey'); const chart = echarts.init(el);
  const carriers = DATA.flows.carriers, mix = DATA.flows.mix;
  const outcomes = [{name:'On-time', key:'outOnTime', color:getCSS('--ok')},{name:'Delay', key:'outDelay', color:getCSS('--warn')},{name:'Exception', key:'outException', color:getCSS('--bad')}];
  function option(){
    const nodes=[{name:'Pedidos'}, ...carriers.map(c=>({name:c})), ...outcomes.map(o=>({name:o.name}))];
    const total=1000, links=[]; carriers.forEach((c,i)=>{const v=Math.round(total*mix[i]); links.push({source:'Pedidos',target:c,value:v}); outcomes.forEach(o=>links.push({source:c,target:o.name,value:Math.round(v*DATA.flows[o.key])}));});
    const colorMap=Object.fromEntries(outcomes.map(o=>[o.name,o.color]));
    return {backgroundColor:'transparent', tooltip:{trigger:'item',formatter:p=>`${p.data.source? p.data.source+' ‚Üí ' : ''}${p.data.name||p.data.target}: <b>${p.data.value}</b>`}, series:[{type:'sankey', nodeGap:12, nodeWidth:16, lineStyle:{color:'gradient', curveness:.5}, itemStyle:{color:p=>colorMap[p.data.name]||getCSS('--brand-2')}, data:nodes, links}]};
  }
  chart.setOption(option()); new ResizeObserver(()=>chart.resize()).observe(el);
})();

/* ============= Waterfall ============= */
(function initWaterfall(){
  const el = document.getElementById('waterfall'); const chart=echarts.init(el);
  const u=DATA.unitEconomics, gross=u.pricePerShipment, shipCost=-u.carrierCost, fin=u.fintechMarginPerShipment, other=-u.otherOps, contrib=gross+shipCost+fin+other;
  const data=[{name:'Receita',value:gross,color:getCSS('--brand-2')},{name:'Custo frete',value:shipCost,color:getCSS('--bad')},{name:'Fintech',value:fin,color:getCSS('--ok')},{name:'Ops var.',value:other,color:getCSS('--warn')},{name:'Margem contrib.',value:contrib,color:getCSS('--brand')}];
  chart.setOption({backgroundColor:'transparent', tooltip:{trigger:'axis',axisPointer:{type:'shadow'},formatter:p=>p.map(i=>`${i.marker} ${i.name}: <b>${fmtBRL(i.data.value)}</b>`).join('<br/>')}, xAxis:{type:'category',data:data.map(d=>d.name),axisLabel:{color:'var(--muted)'}}, yAxis:{type:'value',axisLabel:{color:'var(--muted)'}}, series:[{type:'bar', data:data.map(d=>({value:d.value, itemStyle:{color:d.color}})), label:{show:true, position:'top', formatter:p=>fmtBRL(p.data.value)}}]});
  new ResizeObserver(()=>chart.resize()).observe(el);
})();

/* ============ S√©ries MoM ============ */
(function seriesCharts(){
  new Chart(document.getElementById('areaRevenue'),{type:'line',data:{labels:DATA.revenueMonthly.map((_,i)=>`M${i+1}`),datasets:[{data:DATA.revenueMonthly, borderColor:getCSS('--brand-2'), backgroundColor:'rgba(37,99,235,.22)', fill:true, tension:.35, pointRadius:0}]}, options:{responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{x:{ticks:{color:'var(--muted)'}}, y:{ticks:{color:'var(--muted)'}}}});
  new Chart(document.getElementById('barShipments'),{type:'bar',data:{labels:DATA.shipmentsMonthly.map((_,i)=>`M${i+1}`),datasets:[{data:DATA.shipmentsMonthly, backgroundColor:'rgba(20,184,166,.30)', borderColor:getCSS('--brand'), borderWidth:1}]}, options:{responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{x:{ticks:{color:'var(--muted)'}}, y:{ticks:{color:'var(--muted)'}}}});
})();

/* ============ Cohorts =========== */
(function initCohorts(){
  const ctx=document.getElementById('cohortChart'); const labels=DATA.cohorts.labels, rows=DATA.cohorts.rows; const data=[]; rows.forEach((row,r)=>row.values.forEach((v,c)=>data.push({x:c,y:r,v})));
  const palette=v=> v>=28?getCSS('--brand'): v>=24?getCSS('--brand-2'): v>=20?'#a78bfa': v>=16?getCSS('--accent'):'#f87171';
  new Chart(ctx,{type:'matrix', data:{datasets:[{label:'MRR (R$ mil)', data:data.map(d=>({x:d.x,y:d.y,v:d.v})), width:({chart})=>(chart.chartArea||{}).width/labels.length-4, height:({chart})=>(chart.chartArea||{}).height/rows.length-4, backgroundColor:c=>palette(c.raw.v), borderColor:'rgba(255,255,255,.1)', borderWidth:1}]}, options:{responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}, tooltip:{callbacks:{label:c=>`${rows[c.raw.y].cohort} ‚Ä¢ ${labels[c.raw.x]}: R$ ${c.raw.v}k`}}}, scales:{x:{type:'linear',position:'top',ticks:{callback:v=>labels[v]||''}, grid:{display:false}, offset:true}, y:{type:'linear',ticks:{callback:v=>rows[v]?.cohort||''}, grid:{display:false}, reverse:true, offset:true}}});
})();

/* =========== Simulador =========== */
(function sim(){
  const s_ship=gid('s_ship'), s_rate=gid('s_rate'), s_arpu=gid('s_arpu'), sv_ship=gid('s_ship_v'), sv_rate=gid('s_rate_v'), sv_arpu=gid('s_arpu_v'), out_rev=gid('sim_rev'), out_fin=gid('sim_fin'), out_ratio=gid('sim_ratio');
  function setDefaults(){ s_ship.value=DATA.simDefault.shipments; s_rate.value=DATA.simDefault.takeRatePct; s_arpu.value=DATA.simDefault.arpu; }
  function recompute(){ const ship=+s_ship.value, rate=+s_rate.value/100, arpu=+s_arpu.value; sv_ship.textContent=ship.toLocaleString('pt-BR'); sv_rate.textContent=(+s_rate.value).toFixed(1); sv_arpu.textContent=arpu.toLocaleString('pt-BR'); const price=DATA.unitEconomics.pricePerShipment, gmv=ship*price, revenue=gmv*rate, fintech=ship*DATA.unitEconomics.fintechMarginPerShipment, ratio=(arpu*12)/DATA.cac; out_rev.textContent=fmtBRL(revenue); out_fin.textContent=fmtBRL(fintech); out_ratio.textContent=ratio.toFixed(1)+'x'; }
  setDefaults(); [s_ship,s_rate,s_arpu].forEach(i=>i.addEventListener('input',recompute)); recompute();
})();

/* ============== Utils ============== */
function gid(id){return document.getElementById(id)}
const fmtBRL = n => n.toLocaleString('pt-BR',{style:'currency',currency:'BRL',maximumFractionDigits:0});
const fmtK = n => n>=1000? (Math.round(n/100)/10)+'k': n.toString();
const clamp = (x,a,b)=>Math.max(a,Math.min(b,x));
function getCSS(name){ return getComputedStyle(document.documentElement).getPropertyValue(name).trim() || name }
</script>
</body>
</html>
